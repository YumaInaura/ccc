#!/usr/bin/env bash -eu

# Usuage
#
# $ eco docker rmi
#

readonly current_directory=$(echo "$0" | sed -e "s/\/$(basename "$0")$//g")

commands=''
options=''

for arg in $@; do
  if [[ "$arg" =~ ^[a-z] ]]; then commands="$commands $arg"; fi
  if [[ "$arg" =~ ^- ]]; then options="$options $arg"; fi
done

commands=$(echo $commands | perl -pe 's/^ //')
options=$(echo $options | perl -pe 's/^ //')

readonly file_name=$(basename "$0")
readonly script_file_name=$(echo "$commands" | perl -pe 's/ +/-/g');
readonly script_full_path="$current_directory/$script_file_name"

if [[ "$@" =~ --dry ]]; then
  for name in current_directory commands options script_full_path; do
    echo "$name" $(eval echo '$'"$name")
  done
fi

if [[ -f "$script_full_path" ]]; then
  eval "$script_full_path" "$options"
else
  echo "Command not found"
  ls -1 "$current_directory/bin" | grep -v -e 'eco$' | sed 's/\-/ / ' | sed -E 's/[^0-9A-Za-z_ ]//g' | sed -E 's/^/\$ eco /'
fi

