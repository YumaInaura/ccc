#!/usr/bin/env bash -eu

# Usuage
#
# $ eco docker rmi
#

# readonly current_directory=$(echo "$0" | sed -e "s/\/$(basename "$0")$//g")
readonly eco_home=${ECO_HOME:-"$HOME/eco"}

commands=''
options=''

for arg in $@; do
  if [[ "$arg" =~ ^[a-z] ]]; then commands="$commands $arg"; fi
  if [[ "$arg" =~ ^- ]]; then options="$options $arg"; fi
done

commands=$(echo $commands | perl -pe 's/^ //')
options=$(echo $options | perl -pe 's/^ //')

readonly file_name=$(basename "$0")
readonly script_file_name=$(echo "$commands" | perl -pe 's/ +/-/g');
readonly script_full_path="$eco_home/bin/$script_file_name"

if [[ "$@" =~ --dry ]]; then
  for name in eco_home commands options script_full_path; do
    echo "$name" $(eval echo '$'"$name")
  done
fi

if [[ -f "$script_full_path" ]]; then
  eval "$script_full_path" "$options"
else
  echo "$ $commands $options"
  echo "command not found"
  echo "file path : $script_full_path"

  part_of_command=$(echo "$@" | perl -pe 's/^\s*([a-z][a-z0-9]+).+?$/$1/g')
  echo "================= Command List" 
  echo "----------------- grep by '$part_of_command'"

  ls -1 "$eco_home/bin" | \
    grep -v -e 'eco$' | \
    sed 's/\-/ / ' | \
    sed -E 's/[^0-9A-Za-z_ ]//g' | \
    grep -e "^$part_of_command" | \
    sed -E 's/^/\$ eco /'

fi

